ParseNat â† 10âŠ¸Ã—âŠ¸+ËœÂ´ âˆ˜âŒ½ -âŸœ'0'
ParseNum â† {ğ•Šğ•©: '-'â‰¡âŠ‘ğ•© ? -ParseNat 1â†“ğ•©; ParseNat ğ•©}
Numbers â† {ğ•Šs: ParseNumÂ¨ s âŠ”Ëœ {1-Ëœğ•©Ã—+`0âŒˆğ•©-Â»ğ•©} ('-'=s) âˆ¨ (('0' â‰¤ s) âˆ§ (s â‰¤ '9'))}
Enumerate â† {ğ•©â‹ˆËœÂ¨â†•â‰ ğ•©}

blueprints â† {ğ•Šiâ€¿rrâ€¿crâ€¿orâ€¿ocâ€¿grâ€¿go: âŸ¨rrâ€¿0â€¿0â€¿0, crâ€¿0â€¿0â€¿0, orâ€¿ocâ€¿0â€¿0, grâ€¿0â€¿goâ€¿0âŸ©}Â¨ NumbersÂ¨ â€¢FLines âŠ‘â€¢args

EvalBlueprint â† {tleftğ•Šcosts:
  F â† {ğ•Štleftâ€¿xâ€¿dxâ€¿lboundâ€¿path:
    #{lbound<Â¯1âŠ‘ x+tleftÃ—dx ? â€¢Show âŸ¨"new best", Â¯1âŠ‘x, tleft, dx, pathâŸ©; @}
    ! tleftâ‰¥0 â‹„ ! âˆ§Â´ xâ‰¥0 â‹„ ! âˆ§Â´ dxâ‰¥0
    lbound âŒˆâ†© Â¯1âŠ‘ x+tleftÃ—dx  # score we get if we build no more robots
    ubound â† (Â¯1âŠ‘ x+tleftÃ—dx)++Â´((tleft-1)-â†•0âŒˆ(tleft-1)) # if we could build a geode robot every minute
    {(ubound > lbound) âˆ§ (tleft > 0) ?
      {ğ•Šiâ€¿c: # what do we build next?
        dt â† âŒˆÂ´âŒˆ(c-x)Ã·dx # time until we can afford it (may be zero or negative if we can afford it now)
        (0â‰¤dt) âˆ§ (dt<tleft) ?
          # (dt+1 to jump to time of completion)
          lbound âŒˆâ†© F âŸ¨tleft-dt+1, (x+(dt+1)Ã—dx)-c, (1âŠ¸+)âŒ¾ (iâŠ¸âŠ‘) dx, lbound, pathâˆ¾<(tleft-dt)â€¿iâŸ©
        ; @
      }Â¨ âŒ½ Enumerate costs  # reverse to consider geode branch first
    ;@}
    lbound
  }
  F âŸ¨tleft, 0â€¿0â€¿0â€¿0, 1â€¿0â€¿0â€¿0, 0, âŸ¨âŸ©âŸ©
}

{ # part one
  scores â† 24âŠ¸EvalBlueprintÂ¨ blueprints
  #â€¢Show scores
  â€¢Show +Â´scoresÃ—1+â†•â‰ blueprints
}
{ # part two
  scores â† 32âŠ¸EvalBlueprintÂ¨ (3âŒŠâ‰ blueprints)â†‘blueprints
  #â€¢Show scores
  â€¢Show Ã—Â´scores
}

